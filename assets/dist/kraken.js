!function(){"use strict";const t=window.jQuery;function e(n,a){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=parseInt(window.kraken_options.bulk_async_limit,10);let r=0,k=!1;const c=()=>{for(;n.length>0&&r<s;){r++;const t=n.shift();void 0!==t&&l(t),c()}0===n.length&&0===r&&i<a&&(i++,k=!0,function(n,a,i){t.ajax({type:"POST",url:window.kraken_options.ajax_url,data:{action:"kraken_get_unoptimized_images",nonce:window.kraken_options.nonce},success(t){const o=t.data;o.ids.length>0&&e(o.ids,a,i,n)},error(){}})}(o,a,i))},l=e=>{t.ajax({type:"POST",url:window.kraken_options.ajax_url,data:{action:"kraken_optimize_image",id:e,nonce:window.kraken_options.nonce},success(e){r--,e.success?(o++,t(".kraken-bulk-table tbody")?.append(t(e.data.bulk_stats_html)),t("tr#post-"+e.data.id).find(".kraken-stats-media-column")?.replaceWith(e.data.stats_html),t(".kraken-bulk-actions .optimized").text(o),c(),d()):"nonce"===e.data.type&&window.alert(window.kraken_options.texts.error_reset)},error(){r--,c(),d()}})},d=()=>{if(0===n.length&&!k&&0===r){t(".kraken-bulk-actions").removeClass("is-active"),t(".kraken-button-bulk-optimize .spinner").removeClass("is-active");const e=parseInt(t(".kraken-button-bulk-optimize").data("total"),10),n=window.kraken_options.texts.images_optimized.replace("%1$s",o).replace("%2$s",e);t(".kraken-bulk-images").empty().append("<p>"+n+"</p>")}};c()}t(document).on("click",".kraken-stats-action-show-details",(function(e){e.preventDefault(),t(this).next().toggleClass("is-visible")})),t(document).on("click",".kraken-stats-action-reset-image",(function(e){if(e.preventDefault(),!window.confirm(window.kraken_options.texts.reset_image))return;const n=t(this),a=n.data("id");n.find(".spinner").addClass("is-active"),t.ajax({type:"POST",url:window.kraken_options.ajax_url,data:{action:"kraken_reset_image",id:a,nonce:window.kraken_options.nonce},success(t){t.success?n.parents(".kraken-stats-media-column").replaceWith(t.data.html):window.alert(window.kraken_options.texts.error_reset)},error(){window.alert(window.kraken_options.texts.error_reset)}})})),t(document).on("click",".kraken-button-optimize-image",(function(e){e.preventDefault();const n=t(this),a=n.find(".spinner"),i=n.data("id");a.addClass("is-active"),t.ajax({type:"POST",url:window.kraken_options.ajax_url,data:{action:"kraken_optimize_image",id:i,type:"single",nonce:window.kraken_options.nonce},success(t){t.success?n.parents(".kraken-stats-media-column").replaceWith(t.data.stats_html):(window.alert(window.kraken_options.texts.error_reset),a.removeClass("is-active"))},error(){window.alert(window.kraken_options.texts.error_reset),a.removeClass("is-active")}})})),t(document).on("click",".kraken-button-bulk-optimize",(function(n){n.preventDefault();const a=t(this),i=parseInt(a.data("pages"),10),o=a.data("ids");t(".kraken-bulk-actions").addClass("is-active"),t(".kraken-button-bulk-optimize .spinner").addClass("is-active"),e(o,i)})),t(document).on("submit","#posts-filter",(function(e){const n=new FormData(e.target),a=n.get("action"),i=n.get("action2"),o=n.getAll("media[]");"kraken_bulk"!==a&&"kraken_bulk"!==i||(e.preventDefault(),t(".kraken-modal").addClass("is-active"),o.length&&(t(".kraken-bulk-images-info").text(window.kraken_options.texts.images_to_optimize.replace("%s",o.length)),t(".kraken-bulk-actions").removeAttr("hidden"),t(".kraken-bulk-actions .total").text(o.length),t(".kraken-button-bulk-optimize").attr("data-ids",JSON.stringify(o)),t(".kraken-button-bulk-optimize").attr("data-total",o.length)))})),t(document).on("click",".kraken-bulk-close-modal",(function(){t(".kraken-modal").removeClass("is-active")})),function(t,e){if(0===t.length)return!1;const n=t.find("canvas")[0].getContext("2d"),a=Math.PI/180,i=t.data("percent"),o=t.data("color"),s=3.6*i;n.strokeStyle=o,n.lineWidth=10,n.clearRect(0,0,e,e),n.beginPath(),n.arc(60,60,55,270*a,a*(270+s)),n.stroke()}(t(".kraken-progress-circle"),120)}();